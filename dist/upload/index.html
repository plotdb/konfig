<div><script type="@plotdb/block">var singleton;singleton={digest:{}};module.exports={pkg:{extend:{name:"@plotdb/konfig",version:"main",path:"base"},dependencies:[{name:"ldfile"}]},init:function(e){var t,n,i,u,r,o,l,s,f,a,d=this;t=e.root,n=e.context,i=e.data,u=e.pubsub;r=n.ldview,o=n.ldfile;l=i.dataSource||{};this._meta=i;s={files:[],digest:singleton.digest};f=function(e){return e.map(function(e){return{name:e.name,size:e.size,type:e.type,lastModified:e.lastModified,key:e.key,idx:e.idx,digest:e.digest}})};u.fire("init",{get:function(){return f(s.files)},set:function(e){s.files=(Array.isArray(e)?e:[e]).map(function(e,t){var n;return n=import$({},e),n.idx=t,n});return a.get("input").value=""},default:function(){return[]},meta:function(e){return d._meta=e},object:function(){var i,e;i={changed:false};e=s.files.map(function(t,n){if(t.blob){return Promise.resolve(t)}if(s.digest[t.digest]){return Promise.resolve(s.digest[t.digest])}if(t.key==null||l.getBlob==null){return Promise.resolve(t)}return l.getBlob(t,n).then(function(e){t.blob=e;return o.fromFile(e,"dataurl").then(function(e){t.dataurl=e.result;if(l.digest==null){return}return l.digest(t,n).then(function(e){if(t.digest!==e){i.changed=true}return t.digest=e})})})});return Promise.all(e).then(function(){if(i.changed){debounce(0).then(function(){return u.fire("event","change",f(s.files))})}return s.files})}});return a=new r({root:t,init:{input:function(e){var t;t=e.node;if(d._meta.multiple){return t.setAttribute("multiple",true)}}},action:{change:{input:function(e){var i,t,r;i=e.node;t=function(){var e,t,n=[];for(e=0,t=i.files.length;e<t;++e){r=e;n.push(i.files[r])}return n}().map(function(n,i){return o.fromFile(n,"dataurl").then(function(e){var t;return t={name:n.name,size:n.size,type:n.type,lastModified:n.lastModified},t.dataurl=e.result,t.blob=n,t.idx=i,t}).then(function(t){if(l.digest==null){return t}else{return l.digest(t,i).then(function(e){return t.digest=e,t})}}).then(function(t){if(l.getKey==null){return t}else{return l.getKey(t,i).then(function(e){return t.key=e,t})}}).then(function(e){if(!e.digest){return e}else{return s.digest[e.digest]=e}})});return Promise.all(t).then(function(e){s.files=e;i.value="";return u.fire("event","change",f(e))})}}}})}};function import$(e,t){var n={}.hasOwnProperty;for(var i in t)if(n.call(t,i))e[i]=t[i];return e}</script></div>
