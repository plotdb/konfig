<div><script type="@plotdb/block">var singleton;singleton={hash:{}};module.exports={pkg:{extend:{name:"@plotdb/konfig",version:"main",path:"base"},dependencies:[{name:"ldfile"}]},init:function(e){var t,n,r,u,i,o,a,l,f,s,h=this;t=e.root,n=e.context,r=e.data,u=e.pubsub;i=n.ldview,o=n.ldfile;a=r.dataSource||{};this._meta=r;l={files:[],hash:singleton.hash};f=function(e){return e.map(function(e){return{name:e.name,size:e.size,type:e.type,lastModified:e.lastModified,key:e.key,hkey:e.hkey}})};u.fire("init",{get:function(){return f(l.files)},set:function(e){l.files=(Array.isArray(e)?e:[e]).map(function(e){return import$({},e)});return s.get("input").value=""},default:function(){return[]},meta:function(e){return h._meta=e},object:function(){var e;e=l.files.map(function(n){var e;if(n.blob){return Promise.resolve(n)}if(e=l.hash[n.hkey]){return Promise.resolve(import$(n,e))}if(n.key==null||a.getBlob==null){return Promise.resolve(n)}return a.getBlob(n).then(function(t){return o.fromFile(t,"dataurl").then(function(e){return n.dataurl=e.result,n.blob=t,n})})});return Promise.all(e).then(function(){return l.files})}});return s=new i({root:t,init:{input:function(e){var t;t=e.node;if(h._meta.multiple){return t.setAttribute("multiple",true)}}},action:{change:{input:function(e){var r,t,i;r=e.node;t=function(){var e,t,n=[];for(e=0,t=r.files.length;e<t;++e){i=e;n.push(r.files[i])}return n}().map(function(n){return o.fromFile(n,"dataurl").then(function(e){var t;return t={name:n.name,size:n.size,type:n.type,lastModified:n.lastModified},t.dataurl=e.result,t.blob=n,t}).then(function(t){if(a.getKey==null){return Promise.resolve(t)}return a.getKey(t).then(function(e){return t.key=e,t})}).then(function(e){var t;if(e.key){return e}e.hkey=function(){var e=[];for(t in l.hash){e.push(t)}return e}().length;l.hash[e.hkey]={blob:e.blob,dataurl:e.dataurl};return e})});return Promise.all(t).then(function(e){l.files=e;r.value="";return u.fire("event","change",f(e))})}}}})}};function import$(e,t){var n={}.hasOwnProperty;for(var r in t)if(n.call(t,r))e[r]=t[r];return e}</script></div>
