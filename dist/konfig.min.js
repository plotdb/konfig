!function(){var t;function h(t,e){var n,r={}.hasOwnProperty;for(n in e)r.call(e,n)&&(t[n]=e[n]);return t}(t=function(t){var e=this;return this.root="string"==typeof(t=null==t?{}:t).root?document.querySelector(t.root):t.root,this.opt=t,this.evtHandler={},this.useBundle=null==t.useBundle||t.useBundle,this.view=t.view,this.autotab=t.autotab||!1,this._ctrlobj={},this._ctrllist=[],this._tabobj={},this._tablist=[],this._meta=t.meta||{},this._tab=t.tab||{},this._val={},this.typemap=t.typemap||null,this.mgr=this.mgrChain=new block.manager({registry:function(t){var e=t.name,n=t.version,t=t.path;throw new Error("@plotdb/konfig: "+e+"@"+n+"/"+t+" is not supported")}}),t.manager&&(this.mgr=t.manager,this.mgr.chain(this.mgrChain)),this.init=proxise.once(function(){return e._init()},function(){return e._val}),this._updateDebounced=debounce(150,function(){return e._update()}),this.doDebounce=!(null!=t.debounce)||t.debounce,this.update=function(){return e.doDebounce?e._updateDebounced():e._update()},this}).views={simple:function(){var t=this;return new ldview({root:this.root,initRender:!1,handler:{ctrl:{list:function(){return t._ctrllist.filter(function(t){return!t.meta.hidden})},key:function(t){return t.key},init:function(t){var e=t.node,t=t.data;return e.appendChild(t.root)}}}})},default:function(){var n=this;return new ldview({root:this.root,initRender:!1,handler:{tab:{list:function(){return n._tablist.sort(function(t,e){return e.tab.order-t.tab.order}),n._tablist},key:function(t){return t.key},view:{text:{name:function(t){return t.ctx.tab.id}},handler:{ctrl:{list:function(t){var e=t.ctx;return n._ctrllist.filter(function(t){return t.meta.tab===e.tab.id&&!t.meta.hidden})},key:function(t){return t.key},init:function(t){var e=t.node,t=t.data;return e.appendChild(t.root)},handler:function(t){t.node;return t.data.itf.render()}}}}}}})},recurse:function(){var t,n=this,e=ld$.find(this.root,"[ld=template]",0);return e.parentNode.removeChild(e),e.removeAttribute("ld-scope"),new ldview(h(t={},{ctx:{tab:{id:null}},template:e,root:this.root,initRender:!1,text:{name:function(t){t=t.ctx;return t.tab?(t.tab.name||"")+"":""}},handler:{tab:{list:function(t){var e=t.ctx,t=n._tablist.filter(function(t){return!(t.tab.parent.id||e.tab.id)||t.tab.parent&&e.tab&&t.tab.parent.id===e.tab.id});return t.sort(function(t,e){return e.tab.order-t.tab.order}),t},key:function(t){return t.key},view:t},ctrl:{list:function(t){var e=t.ctx;return n._ctrllist.filter(function(t){return!!e.tab&&(t.meta.tab===e.tab.id&&!t.meta.hidden)})},key:function(t){return t.key},init:function(t){var e=t.node,t=t.data;return e.appendChild(t.root)},handler:function(t){var e=t.node,t=t.data;return e.style.flex="1 1 "+16*(t.meta.weight||1)+"%",t.itf.render()}}}}))}},t.prototype=h(Object.create(Object.prototype),{on:function(t,e){var n;return((n=this.evtHandler)[t]||(n[t]=[])).push(e)},fire:function(t){for(var e,n,r,i,o=[],a=[],d=1,l=arguments.length;d<l;++d)a.push(arguments[d]);for(e=a,d=0,r=(n=this.evtHandler[t]||[]).length;d<r;++d)i=n[d],o.push(i.apply(this,e));return o},render:function(){if(this.view)return this._view||("string"==typeof this.view?this._view=t.views[this.view].apply(this):this._view=this.view),this._view.render()},meta:function(t){var e=t.meta,t=t.tab;return null!=e&&(this._meta=e),null!=t&&(this._tab=t),this.build(!0)},get:function(){return JSON.parse(JSON.stringify(this._val))},set:function(t){return this._val=JSON.parse(JSON.stringify(t)),this.render()},_update:function(){return this.fire("change",this._val)},_init:function(){var e=this;return this.mgr.init().then(function(){return e.useBundle&&t.bundle||[]}).then(function(t){return e.mgr.set(t.map(function(t){return new block.class((t.manager=e.mgr,t))}))}).then(function(){return e.build()}).then(function(){return e._val})},_prepareTab:function(t){var e;return this._tabobj[t.id]?((e=this._tabobj[t.id]).tab=t,e):(e=document.createElement("div"),this._tablist.push(e={root:e,tab:t,key:Math.random().toString(36).substring(2)}),this._tabobj[t.id]=e)},_prepareCtrl:function(n,e,r){var t,i,o,a,d=this,l=n.id;return r[l]?Promise.resolve():(o=n.block?(t=(o={name:(o=n.block).name,version:o.version,path:o.path}).name,i=o.version,o.path):this.typemap&&(a=this.typemap(n.type))?(t=a.name,i=a.version,a.path):(t=(o=[n.type,"master",""])[0],i=o[1],o[2]),this.mgr.get({name:t,version:i,path:o}).then(function(t){return t.create({data:n})}).then(function(t){var e=document.createElement("div");return null==n.tab&&(n.tab="default"),d._tabobj[n.tab]||d._prepareTab({id:n.tab,name:n.tab,depth:0,parent:{}}),d._ctrllist.push(r[l]={block:t,meta:n,root:e,key:Math.random().toString(36).substring(2)}),t.attach({root:e}).then(function(){return t.interface()}).then(function(t){return r[l].itf=t})}).then(function(t){return e[l]=t.get(),t.on("change",function(t){return e[l]=t,d.update()})}).then(function(){return r[l]}))},build:function(t){var e=this;return this._buildTab(t=null==t?!1:t),this._buildCtrl(t).then(function(){return e.render()}).then(function(){return e.update()})},_buildCtrl:function(t){var u=this,s=[],c=function(t,e,n,r){var i,o,a,d,l=[];if(null==e&&(e={}),null==n&&(n={}),t&&"object"==typeof t&&(i=t.child||t,!(o=t.child?t.tab:null)&&u.autotab&&r&&(o=r),i)){for(a in i)(d=i[a]).type?(h((d.id=a,d),o&&!d.tab?{tab:o}:{}),s.push(u._prepareCtrl(d,e,n))):l.push(c(d,e[a]||(e[a]={}),n[a]||(n[a]={}),a));return l}};return(t=null==t?!1:t)&&this._ctrllist&&this._ctrllist.map(function(t){var e=t.block,t=t.root;if(e.destroy&&e.destroy(),t.parentNode)return t.parentNode.removeChild(t)}),!t&&this._val||(this._val={}),!t&&this._ctrlobj||(this._ctrlobj={}),!t&&this._ctrllist||(this._ctrllist=[]),c(this._meta,this._val,this._ctrlobj,null),Promise.all(s)},_buildTab:function(t){var c,p=this;if(null==t&&(t=!1),"ctrl"!==this.renderMode)return t&&this._tablist&&this._tablist.map(function(t){t=t.root;if(t.parentNode)return t.parentNode.removeChild(t)}),!t&&this._tablist||(this._tablist=[]),!t&&this._tab||(this._tab={}),t&&(this._tabobj={}),(c=function(n,t,e){var r,i,o,a,d,l,u,s=[];if(null==t&&(t=0),null==e&&(e={}),n&&(Array.isArray(n)||"object"==typeof n)){for(a=0,d=(r=Array.isArray(n)?n:function(){var t,e=[];for(i in t=n)o=t[i],e.push({id:i,v:o});return e}().map(function(t,e){var n=t.id,t=t.v;return t.id=n,t})).length;a<d;++a)h(((u=r[l=a]).depth=t,u.parent=e,u),o.name?{}:{name:u.id}),h(u,null==o.order?{order:l}:{}),p._prepareTab(u),s.push(c(u.child,(u.depth||0)+1,u));return s}})(this._tab)}}),"undefined"!=typeof module&&null!==module?module.exports=t:"undefined"!=typeof window&&null!==window&&(window.konfig=t),t.bundle=(t.bundle||[]).concat([{name:"@plotdb/konfig.widget.default",version:"master",path:"base",code:'<div><div class="d-flex"><div class="flex-grow-1 d-flex align-items-center"><div ld="name"></div><div ld="hint">?</div></div><plug name="ctrl"></plug></div><plug name="config"></plug><style type="text/css">[ld=hint]{margin-left:.5em;width:1.2em;height:1.2em;border-radius:50%;background:rgba(0,0,0,0.1);font-size:10px;line-height:1.1em;text-align:center;cursor:pointer}</style><script type="@plotdb/block"><\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"boolean",code:'<div><script type="@plotdb/block"><\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"button",code:'<div><script type="@plotdb/block"><\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"choice",code:'<div><script type="@plotdb/block"><\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"color",code:'<div><script type="@plotdb/block"><\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"font",code:'<div><script type="@plotdb/block"><\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"number",code:'<div><script type="@plotdb/block">function import$(r,n){var o,t={}.hasOwnProperty;for(o in n)t.call(n,o)&&(r[o]=n[o]);return r}<\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"palette",code:'<div><script type="@plotdb/block"><\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"paragraph",code:'<div><script type="@plotdb/block">function import$(r,n){var o,t={}.hasOwnProperty;for(o in n)t.call(n,o)&&(r[o]=n[o]);return r}<\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"popup",code:'<div><script type="@plotdb/block"><\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"text",code:'<div><script type="@plotdb/block"><\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"upload",code:'<div><script type="@plotdb/block"><\/script></div>'}])}();
