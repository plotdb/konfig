<div><script type="@plotdb/block">var singleton;singleton={digest:{}};module.exports={pkg:{syncInit:true,extend:{name:"@plotdb/konfig",version:"main",path:"base"},dependencies:[{name:"@xlfont/load",version:"main",path:"index.min.js"},{name:"@xlfont/choose",version:"main",path:"index.min.js"},{name:"@xlfont/choose",version:"main",path:"index.min.css",global:true}],i18n:{en:{default:"Default"},"zh-TW":{"system default":"預設字型"}}},init:function(n){var e,t,i,o,r,f,l,u,a,d,c,s,m,g,h,v,b,y,p;e=n.root,t=n.context,i=n.data,o=n.pubsub,r=n.t;f=t.ldview,l=t.ldcover,u=t.xfc;a=i.dataSource||{};d={font:null,fobj:null,digest:singleton.digest};c=function(){return typeof d._m["default"]==="string"?{name:d._m["default"]}:d._m["default"]||{}};s=function(n){var t,e,i;n==null&&(n={});t=n.font;e=n.cancelable;if(!t){t=d.font||(d.font=c())}i=(t.mod||(t.mod={})).file||{};return Promise.resolve().then(function(){return i.blob instanceof Blob?i.blob:d.digest[i.digest]?d.digest[i.digest].blob:null}).then(function(n){if(n||!i.digest){return n}else if(a.getBlob){return a.getBlob(i)}else{return n}}).then(function(n){i.blob=n;if(!(n&&a.digest)){return}return a.digest(i).then(function(n){var e;if(i.digest!==n){d.changed=true}i.digest=n;return import$((e=t.mod||(t.mod={})).file||(e.file={}),i)})}).then(function(){return b.load(t)["catch"](function(){return b.load(c())})["catch"](function(){return null})}).then(function(n){if(d.font!==t&&e){return lderror.reject(999)}if(d.font===t){d.fobj=n;m()}return n||{}})};m=function(){return e.classList.toggle("limited",g())};g=function(){var n;return!!(d.fobj&&((n=d.fobj).mod||(n.mod={})).limited)};h=function(n){var e,t,i;n==null&&(n={});e=n.mod||{};t={name:n.name,style:n.style,weight:n.weight};if(e.limited){(t.mod||(t.mod={})).limited=e.limited}if(e.file&&(e.file.blob||e.file.key||e.file.digest)){(t.mod||(t.mod={})).file={key:(i=e.file).key,digest:i.digest,name:i.name,lastModified:i.lastModified,size:i.size,type:i.type}}return t};o.fire("init",{get:function(){return!d.font?this["default"]()||"":h(d.font)},set:function(n,e){var t,i;e==null&&(e={});t=!n?n:typeof n==="string"?{name:n}:h(n);i=JSON.stringify(d.font||{})!==JSON.stringify(t||{})&&!e.passive;d.font=t;d.fobj=null;if(i){o.fire("event","change",d.font)}return d.view.render("font-name")},default:function(){return c()},meta:function(n){return d._meta=n},object:function(n){n==null&&(n={});return s({font:n})},limited:function(){return g()}});d._m=i||{};d.font=c();v=u.url?u.url():{};b=new u({root:!e?null:e.querySelector(".ldcv"),initRender:false,meta:v.meta||"https://xlfont.maketext.io/meta",links:v.links||"https://xlfont.maketext.io/links"});o.on("config",function(n){n==null&&(n={});b.config(n);d.fobj=null;return s()});if(!e){return}b.on("choose",function(n){return d.ldcv.set(n)});y=e.querySelector("[ld=ldcv]");d.view=p=new f({root:e,init:{ldcv:function(n){var e;e=n.node;d.ldcv=new l({root:e,inPlace:false});return d.ldcv.on("toggle.on",function(){return debounce(50).then(function(){return b.render()})})}},action:{click:{system:function(n){var e,t;e=n.node;d.font=t=null;d.fobj=null;p.render("font-name");return o.fire("event","change",t)},button:function(n){var e;e=n.node;return d.ldcv.get().then(function(e){var t;if(!e){return{font:e}}t=(e.mod||{}).file;if(!(t&&t.blob&&a.digest)){return{font:e}}return a.digest(t).then(function(n){t.digest=n;d.digest[n]=t;if(a.getKey==null){return{font:e,file:t}}return a.getKey(t).then(function(n){t.key=n;return{font:e,file:t}})})}).then(function(n){var e,t,i;e=n.font,t=n.file;if(!e){return}d.font={name:e.name,style:e.style,weight:e.weight};((i=d.font).mod||(i.mod={})).file=t;d.fobj=null;p.render("font-name");return o.fire("event","change",d.font)})}}},handler:{"font-name":function(n){var t,e;t=n.node;e=!d.font?r("default"):d.font.name||r("default");if(e.length>10){e=e.substring(0,10)+"..."}t.innerText=e;return s({cancelable:true}).then(function(n){var e;t.setAttribute("class",(e=n&&n.className)?e:"");return t.setAttribute("title",n?n.name||"unnamed":"unnamed")})["catch"](function(n){if(lderror.id(n)===999){}})}}});return this.chooser=function(){return b},this.cover=function(){return d.ldcv},this.dom={cover:y},this.metadata=function(n){return b.metadata(n)},this}};function import$(n,e){var t={}.hasOwnProperty;for(var i in e)if(t.call(e,i))n[i]=e[i];return n}</script></div>
