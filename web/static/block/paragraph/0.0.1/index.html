<div><div plug="config"><textarea rows="1" ld="input"></textarea><div class="ldcv inline" ld="ldcv"><div class="base" ld="panel"><div class="inner"><div class="p-2"><textarea class="form-control" ld="textarea" rows="3"></textarea></div><div class="px-2 pb-2 text-right"><div class="btn btn-sm btn-outline-secondary" data-ldcv-set="">Cancel</div><div class="btn btn-sm btn-primary ml-2" data-ldcv-set="ok">OK</div></div></div></div></div></div><style type="text/css">input,
textarea {
  width: 100%;
}
textarea {
  width: 100%;
  min-height: 2em;
}
textarea[ld=input] {
  resize: none;
}
.ldcv.inline {
  position: absolute;
}
.ldcv.inline:before {
  background: rgba(0,0,0,0.1);
}
.ldcv.inline:after {
  display: none;
}
.ldcv.inline .base {
  position: absolute;
}
</style><script type="@plotdb/block">(function(it){
  return it();
})(function(){
  var blockFactory;
  blockFactory = {
    pkg: {
      name: 'paragraph',
      version: '0.0.1',
      extend: {
        name: 'base',
        version: '0.0.1'
      },
      dependencies: [
        {
          url: "/assets/lib/ldcover/main/ldcv.min.js"
        }, {
          url: "/assets/lib/ldcover/main/ldcv.min.css"
        }
      ]
    },
    init: function(arg$){
      var root, context, data, pubsub, obj, ldview, ldCover, view;
      root = arg$.root, context = arg$.context, data = arg$.data, pubsub = arg$.pubsub;
      obj = {
        data: data['default'] || ''
      };
      ldview = context.ldview, ldCover = context.ldCover;
      pubsub.fire('init', {
        get: function(){
          return obj.data || '';
        },
        set: function(it){
          obj.data = it || '';
          return view.render();
        }
      });
      return view = new ldview({
        root: root,
        init: {
          ldcv: function(arg$){
            var node;
            node = arg$.node;
            return obj.ldcv = new ldCover({
              root: node
            });
          }
        },
        handler: {
          panel: function(arg$){
            var node;
            node = arg$.node;
          },
          input: function(arg$){
            var node;
            node = arg$.node;
            return node.value = obj.data || '';
          },
          textarea: function(arg$){
            var node;
            node = arg$.node;
            return node.value = obj.data || '';
          }
        },
        action: {
          click: {
            input: function(arg$){
              var node, ibox, pbox;
              node = arg$.node;
              ibox = view.get('input').getBoundingClientRect();
              pbox = view.get('panel').getBoundingClientRect();
              import$(view.get('panel').style, {
                width: ibox.width + "px",
                left: ibox.left + "px",
                top: ibox.top + "px"
              });
              return obj.ldcv.get().then(function(it){
                var value;
                if (it !== 'ok') {
                  return;
                }
                value = view.get('textarea').value;
                if (obj.data !== value) {
                  pubsub.fire('event', 'change', value);
                }
                obj.data = value;
                return view.render();
              });
            }
          }
        }
      });
    }
  };
  return blockFactory;
});
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}</script></div>