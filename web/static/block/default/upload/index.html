<div><script type="@plotdb/block">var singleton;singleton={digest:{}};module.exports={pkg:{extend:{name:"@plotdb/konfig",version:"main",path:"base"},dependencies:[{name:"ldfile"}]},init:function(e){var t,n,i,u,r,l,o,a,s,f,d=this;t=e.root,n=e.context,i=e.data,u=e.pubsub;r=n.ldview,l=n.ldfile;o=i.dataSource||{};this._meta=i;a={files:[],digest:singleton.digest};s=function(e){return e.map(function(e){return{name:e.name,size:e.size,type:e.type,lastModified:e.lastModified,key:e.key,idx:e.idx,digest:e.digest}})};u.fire("init",{get:function(){return s(a.files)},set:function(e){a.files=(Array.isArray(e)?e:[e]).map(function(e,t){var n,i,r;return i=(r=import$({},e),r.idx=t,r),i.blob=(n=a.digest[e.digest]||{}).blob,i.dataurl=n.dataurl,i});return f.get("input").value=""},default:function(){return[]},meta:function(e){return d._meta=e},object:function(){var i,e;i={changed:false};e=a.files.map(function(t,n){var e;if(t.blob){return Promise.resolve(t)}if(a.digest[t.digest]){return Promise.resolve((t.blob=(e=a.digest[t.digest]).blob,t.dataurl=e.dataurl,t))}if(t.key==null||o.getBlob==null){return Promise.resolve(t)}return o.getBlob(t,n).then(function(e){t.blob=e;return l.fromFile(e,"dataurl").then(function(e){t.dataurl=e.result;if(o.digest==null){return}return o.digest(t,n).then(function(e){if(t.digest!==e){i.changed=true}return t.digest=e})})})});return Promise.all(e).then(function(){if(i.changed){debounce(0).then(function(){return u.fire("event","change",s(a.files))})}return a.files})}});return f=new r({root:t,init:{input:function(e){var t;t=e.node;if(d._meta.multiple){return t.setAttribute("multiple",true)}}},action:{change:{input:function(e){var i,t,r;i=e.node;t=function(){var e,t,n=[];for(e=0,t=i.files.length;e<t;++e){r=e;n.push(i.files[r])}return n}().map(function(n,i){return l.fromFile(n,"dataurl").then(function(e){var t;return t={name:n.name,size:n.size,type:n.type,lastModified:n.lastModified},t.dataurl=e.result,t.blob=n,t.idx=i,t}).then(function(t){if(o.digest==null){return t}else{return o.digest(t,i).then(function(e){return t.digest=e,t})}}).then(function(t){if(o.getKey==null){return t}else{return o.getKey(t,i).then(function(e){return t.key=e,t})}}).then(function(e){if(!e.digest){return e}else{return a.digest[e.digest]=e}})});return Promise.all(t).then(function(e){a.files=e;i.value="";return u.fire("event","change",s(e))})}}}})}};function import$(e,t){var n={}.hasOwnProperty;for(var i in t)if(n.call(t,i))e[i]=t[i];return e}</script></div>